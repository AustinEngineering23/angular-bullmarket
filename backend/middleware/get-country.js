const express = require("express");
const Country = require("../models/country");
const router = express.Router();
const axios = require('axios');

// Country Name, Capital City, Population, Urban Rent, Urban PE, Rural Rent, Rural PE, Interest Rate, Debt GDP, Inflation Rate, Bond Symbol, Urban RE Symbol, Rural RE Symbol
const country = [
    ['Afghanistan','Kabul','32000000','133.11','27.15','71.34','23.16','15.00','7','6.30','AFGBOND','AFGUR','AFGRR'],
    ['Albania','Tirana','3000000','305.74','23.84','186.20','19.25','0.50','64','1.30','ALBBOND','ALBUR','ALBRR'],
    ['Algeria','Algiers','44000000','182.31','32.01','118.34','25.36', '3.75','46', '2.20','DZABOND','DZAUR','DZARR'],
    ['Angola','Luanda','31000000','193.29','0','96.64','0', '15.50','111', '23.40','BOND','UR','RR'],
    ['Argentina','Buenos Aires','45000000','223.75','52.97','170.12','51.31', '36.90','89', '39.20','BOND','UR','RR'],
    ['Armenia','Yerevan','3000000','362.48','19.16','200.64','19.73', '4.25','46', '1.80','BOND','UR','RR'],
    ['Australia','Canberra','25000000','1254.08','22.97','922.26','22.23', '0.86','45', '-0.30','BOND','UR','RR'],
    ['Austria','Vienna','9000000','874.34','31.51','678.26','28.18', '-0.35','70', '1.40','BOND','UR','RR'],
    ['Azerbaijan','Baku','10000000','311.18','19.46','175.56','17.66', '6.50','48', '2.90','BOND','UR','RR'],
    ['Bahrain','Manama','1500000','956.61','13.44','657.25','12.58', '3.16','93', '-3.6','BOND','UR','RR'],
    ['Bangladesh','Dhaka','161000000','130.66','31.94','79.25','27.84', '7.55','28', '5.70','BOND','UR','RR'],
    ['Belarus','Minsk','9000000','327.06','21.19','214.10','22.8', '7.75','27', '5.60','BOND','UR','RR'],
    ['Belgium','Brussels','11000000','867.5','20.47','713.14','19.98', '-0.28','99', '0.90','BOND','UR','RR'],
    ['Benin','Porto-Novo','11000000','57.86','0','53.41','0', '4.00','22', '3.90','BOND','UR','RR'],
    ['Bolivia','La Paz','11000000','350.82','14.44','246.6','13.75', '3.34','58', '1.40','BOND','UR','RR'],
    ['Bosnia and Herzegovina','Sarajevo','3000000','229.50','31.06','157.53','31.01', '3.05','25', '1.30','BOND','UR','RR'],
    ['Botswana','Gaborone','2000000','281.44','0','232.90','0', '3.63','23', '1.40','BOND','UR','RR'],
    ['Brazil','Brasilia','210000000','237.19','23.9','166.26','23.3', '7.20','76', '2.40','BOND','UR','RR'],
    ['Bulgaria','Sofia','7000000','327.76','20.17','245.55','17.46', '0.28','21', '1.28','BOND','UR','RR'],
    ['Burkina Faso','Ouagadougou','22000000','278.93','0','111.27','0', '4.00','23', '1.10','BOND','UR','RR'],
    ['Burundi','Gitega','12000000','476.69','0','155.72','0', '6.00','14', '7.70','BOND','UR','RR'],
    ['Cambodia','Phnom Penh','15000000','418.30','21.62','250','17.37', '1.50','29', '3.20','BOND','UR','RR'],
    ['Cameroon','Yaounde','27000000','173.29','0','97.92','0', '3.25','34', '2.40','BOND','UR','RR'],
    ['Canada','Ottawa','38000000','1017.25','21.96','826.16','18.35', '0.54','90', '0.10','BOND','UR','RR'],
    ['Chad','NDjamena','14000000','0','0','74.18','0', '3.25','47', '3.50','BOND','UR','RR'],
    ['Chile','Santiago','18000000','428.77','25.71','354.75','26.04', '2.67','28', '2.40','BOND','UR','RR'],
    ['China','Beijing','1400000000','523.04','61.18','290.85','56.69', '3.11','51', '2.40','BOND','UR','RR'],
    ['Colombia','Bogota','50000000','298.03','20.86','220.96','21.65', '5.15','48', '1.90','BOND','UR','RR'],
    ['Congo','Kinshasa','90000000','0','0','0','0', '18.50','99', '28.70','BOND','UR','RR'],
    ['Costa Rica','San Jose','5000000','490.28','17.31','356.52','18.06', '0.75','77', '0.10','BOND','UR','RR'],
    ['Croatia','Zagreb','4000000','484.10','29.14','368.81','27.27', '0.83','73', '-0.20','BOND','UR','RR'],
    ['Cyprus','Nicosia','1200000','667.73','15.84','543.45','15.2', '0.59','96', '-1.20','BOND','UR','RR'],
    ['Cuba','Havana','11000000','177.50','0','57.5','0', '2.25','18', '5.70','BOND','UR','RR'],
    ['Czech Republic','Prague','11000000','654.46','31.9','509.15','29.2', '0.83','31', '3.30','BOND','UR','RR'],
    ['Denmark','Copenhagen','6000000','1119.97','24.1','799.52','23.1', '-0.42','33', '0.50','BOND','UR','RR'],
    ['Dominican Republic','Santo Domingo','11000000','364.46','13.23','200.29','13.33', '3.00','51', '4.80','BOND','UR','RR'],
    ['Ecuador','Quito','17000000','393.94','17.11','282.88','16.79', '9.12','49', '0.80','BOND','UR','RR'],
    ['Egypt','Cairo','100000000','192.56','18.29','117','15.55', '15.18','90', '-3.40','BOND','UR','RR'],
    ['El Salvador','San Salvador','6000000','380','0','306.25','0', '4.18','73', '-0.30','BOND','UR','RR'],
    ['Eritrea','Asmara','6000000','100','0','66.68','0', '0','20', '-27.60','BOND','UR','RR'],
    ['Estonia','Tallinn','1300000','545.04','24.95','376.21','24.57', '0.00','8', '-0.90','BOND','UR','RR'],
    ['Ethiopia','Addis Ababa','109000000','352.29','0','162.17','0', '7.00','57', '20.00','BOND','UR','RR'],
    ['Finland','Helsinki','6000000','905.98','32.04','692.37','24.5', '-0.35','59', '0.20','BOND','UR','RR'],
    ['France','Paris','67000000','813.34','42.33','609.71','', '-0.25','98', '0.10','BOND','UR','RR'],
    ['Georgia','Tbilisi','4000000','320.14','14.04','206.53','11.94', '8.00','43', '3.80','BOND','UR','RR'],
    ['Germany','Berlin','83000000','887.78','31.04','656.60','28.13', '-0.50','60', '0.20','BOND','UR','RR'],
    ['Ghana','Accra','31000000','674.78','0','146.19','0', '14.50','59', '10.50','BOND','UR','RR'],
    ['Greece','Athens','10000000','399.87','23.4','329.39','24.17', '1.01','177', '1.90','BOND','UR','RR'],
    ['Guatemala','Guatemala City','17000000','548.48','14.1','349.83','13.7', '1.75','28', '2.90','BOND','UR','RR'],
    ['Guinea','Conakry','12000000','566.67','0','233.33','0', '11.50','18', '11.30','BOND','UR','RR'],
    ['Honduras','Tegucigalpa','10000000','339.41','12.93','260.14','16.23', '3.75','44', '3.20','BOND','UR','RR'],
    ['Hungary','Budapest','10000000','418.91','26.03','320.99','23.38', '2.42','66', '3.90','BOND','UR','RR'],
    ['Iceland','Reykjavik','360000','1337.49','15.73','1087.67','14.4', '2.66','37', '3.50','BOND','UR','RR'],
    ['India','New Delhi','1350000000','170.14','32.11','105.69','27.51', '5.99','70', '6.70','BOND','UR','RR'],
    ['Indonesia','Jakarta','268000000','288.95','22.73','181.96','20.2', '6.99','30', '1.40','BOND','UR','RR'],
    ['Iran','Tehran','83000000','535.95','22.35','336.83','19.27', '18.00','44', '34.40','BOND','UR','RR'],
    ['Iraq','Baghdad','38000000','377.23','17.2','243.56','13.74', '4.00','48', '0.70','BOND','UR','RR'],
    ['Ireland','Dublin','7000000','1475.87','16.06','1196.43','14.01', '-0.17','59', '1.00','BOND','UR','RR'],
    ['Israel','Jerusalem','9000000','1062.84','34.28','816.80','33.95', '0.66','60', '0.80','BOND','UR','RR'],
    ['Italy','Rome','60000000','726.42','26.32','544.91','20.82', '0.85','135', '0.50','BOND','UR','RR'],
    ['Ivory Coast','Yamoussoukro','26000000','623.14','0','197.82','0', '4.00','132', '2.70','BOND','UR','RR'],
    ['Jamaica','Kingston','3000000','436.11','0','252.56','0', '0.50','103', '5.60','BOND','UR','RR'],
    ['Japan','Tokyo','126000000','827.36','45.15','548.55','40.72', '0.01','237', '-0.20','BOND','UR','RR'],
    ['Jordan','Amman','10000000','344.71','16.49','244.08','14', '4.68','92', '-0.60','BOND','UR','RR'],
    ['Kazakhstan','Nur-Sultan','19000000','298.42','14.21','195.44','14.96', '9.00','22', '7.00','BOND','UR','RR'],
    ['Kenya','Nairobi','48000000','283.03','64.9','140.08','28.31', '12.02','57', '4.20','BOND','UR','RR'],
    ['Kuwait','Kuwait City','4000000','889.39','31.88','701.84','19.26', '1.50','15', '1.90','BOND','UR','RR'],
    ['Kyrgyzstan','Bishkek','6500000','238.28','14.56','162.13','14.84', '5.00','54', '5.00','BOND','UR','RR'],
    ['Laos','Vientiane','7000000','628.50','0','335.58','0', '3.00','53', '5.10','BOND','UR','RR'],
    ['Lebanon','Beirut','7000000','803.92','18.71','405.54','17.87', '4.53','151', '120.00','BOND','UR','RR'],
    ['Libya','Tripoli','7000000','494.32','0','302.08','0', '3.00','17', '1.30','BOND','UR','RR'],
    ['Lithuania','Vilnius','3000000','521.52','25.51','348.13','22.85', '0.14','36', '1.30','BOND','UR','RR'],
    ['Madagascar','Antananarivo','26000000','247.18','0','88.46','0', '9.50','30', '4.00','BOND','UR','RR'],
    ['Malawi','Lilongwe','19000000','461.24','0','325.96','0', '13.50','62', '7.60','BOND','UR','RR'],
    ['Malaysia','Kuala Lumpur','33000000','365.41','27.67','227.29','25.16', '2.76','52', '1.40','BOND','UR','RR'],
    ['Mexico','Mexico City','129000000','348.28','15.82','215.06','15.32', '5.84','46', '4.10','BOND','UR','RR'],
    ['Mongolia','Ulanbaatar','3000000','353.51','12.82','224.93','13.29', '9.00','55', '2.10','BOND','UR','RR'],
    ['Morocco','Rabat','36000000','329.55','21.32','181.92','21.77', '2.35','66', '0.90','BOND','UR','RR'],
    ['Namibia','Windhoek','3000000','365.64','0','269.28','0', '10.95','45', '2.40','BOND','UR','RR'],
    ['Nepal','Kathmandu','28000000','134.17','36.3','96.95','28.46', '5.00','30', '4.80','BOND','UR','RR'],
    ['Netherlands','Amsterdam','17000000','1299.42','18.54','1032.88','17.72', '-0.39','49', '0.70','BOND','UR','RR'],
    ['New Zealand','Wellington','5000000','1086.22','23.1','857.76','22.16', '0.48','19', '1.50','BOND','UR','RR'],
    ['Nicaragua','Managua','6000000','246.14','0','185.91','0', '10.00','53', '3.60','BOND','UR','RR'],
    ['Niger','Niamey','22000000','373.72','0','303.64','0', '4.00','34', '2.60','BOND','UR','RR'],
    ['Nigeria','Abuja','206000000','709.20','0','506.56','0', '9.00','18', '13.20','BOND','UR','RR'],
    ['Norway','Oslo','5000000','1154.57','27.7','860.78','24.73', '0.65','41', '1.70','BOND','UR','RR'],
    ['Oman','Muscat','5000000','564.52','18.13','385.67','22.34', '0.50','48', '1.35','BOND','UR','RR'],
    ['Pakistan','Islamabad','212000000','133.58','20.48','83.13','19.78', '9.64','85', '9.00','BOND','UR','RR'],
    ['Panama','Panama City','4000000','784.15','12.11','525.68','12.84', '1.36','40', '-2.40','BOND','UR','RR'],
    ['Paraguay','Asuncion','7000000','274.37','0','185.42','0', '0.75','23', '1.60','BOND','UR','RR'],
    ['Peru','Lima','33000000','413.61','18.24','249.66','18.51', '4.25','28', '1.80','BOND','UR','RR'],
    ['Philippines','City of Manila','100000000','352.04','30.77','194.84','29.28', '3.09','42', '2.40','BOND','UR','RR'],
    ['Poland','Warsaw','38000000','568.34','23.74','428.42','20.56', '1.33','46', '3.20','BOND','UR','RR'],
    ['Portugal','Lisbon','10000000','739.06','19.88','541.12','16.67', '0.25','118', '-0.10','BOND','UR','RR'],
    ['Romania','Bucharest','19000000','357.77','22.47','255.46','21.85', '3.50','35', '2.70','BOND','UR','RR'],
    ['Russia','Moscow','147000000','296.69','17.5','207.54','16.95', '6.27','12', '3.60','BOND','UR','RR'],
    ['Rwanda','Kigali','12000000','435.51','0','234.18','0', '4.50','41', '10.90','BOND','UR','RR'],
    ['Saudi Arabia','Riyadh','34000000','384.35','13.06','277.32','11.78', '1.00','23', '6.20','BOND','UR','RR'],
    ['Senegal','Dakar','16000000','603.90','0','249.26','0', '4.00','48', '3.00','BOND','UR','RR'],
    ['Serbia','Belgrade','7000000','309.37','31.9','209.52','29.68', '3.03','52', '1.90','BOND','UR','RR'],
    ['Sierra Leone','Freetown','7000000','633.64','0','152.07','0', '15.00','63', '14.36','BOND','UR','RR'],
    ['Singapore','Singapore','6000000','2162.82','41.35','1387.55','33.85', '0.84','126', '-0.40','BOND','UR','RR'],
    ['Slovakia','Bratislava','5000000','579.38','21.95','451.99','20.64', '-0.28','48', '1.40','BOND','UR','RR'],
    ['Somalia','Mogadishu','16000000','174','0','82.69','0', '0','0', '4.10','BOND','UR','RR'],
    ['South Africa','Cape Town','60000000','453.45','11.9','363.21','9.05', '9.48','62', '3.10','BOND','UR','RR'],
    ['South Korea','Seoul','52000000','582.4','76.34','398.29','61.33', '1.45','37', '0.70','BOND','UR','RR'],
    ['Spain','Madrid','47000000','802.74','22.07','604.19','19.23', '0.23','96', '-0.40','BOND','UR','RR'],
    ['Sudan','Khartoum','42000000','377','0','204.38','0', '15.80','62', '166.80','BOND','UR','RR'],
    ['Sweden','Stockholm','10000000','957.47','30.42','678.73','27.86', '-0.12','35', '0.80','BOND','UR','RR'],
    ['Switzerland','Bern','9000000','1659.91','33.54','1265.75','29.69', '-0.50','41', '-0.80','BOND','UR','RR'],
    ['Syria','Damascus','17500000','203.82','33.07','101.49','32.19', '0','77', '13.10','BOND','UR','RR'],
    ['Thailand','Bangkok','70000000','486.21','28.96','276.04','27.02', '1.33','42', '-0.50','BOND','UR','RR'],
    ['Tunisia','Tunis','12000000','190.50','20.09','127.5','19.59', '6.75','77', '5.40','BOND','UR','RR'],
    ['Turkey','Ankara','83000000','218.56','18.38','134.68','16.1', '14.12','33', '11.70','BOND','UR','RR'],
    ['Uganda','Kampala','43000000','195.3','0','118.66','0', '14.59','40', '4.50','BOND','UR','RR'],
    ['Ukraine','Kiev','42000000','294.23','15.94','197.86','13.12', '14.71','50', '2.50','BOND','UR','RR'],
    ['United Kingdom','London','68000000','985.51','26.8','784.42','23.97', '0.20','81', '0.20','BOND','UR','RR'],
    ['United States','Washington','330000000','1363.36','11.15','1088.27','9.25', '0.67','107', '1.30','BOND','UR','RR'],
    ['Uruguay','Montevideo','3500000','416.53','26.13','322.29','25.18', '13.80','61', '9.80','BOND','UR','RR'],
    ['Uzbekistan','Tashkent','34000000','245.83','15.86','153.85','13.76', '14.00','24', '11.70','BOND','UR','RR'],
    ['Venezuela','Caracas','29000000','319.09','0','298.75','0', '46.58','23', '2358.00','BOND','UR','RR'],
    ['Vietnam','Hanoi','96000000','414.4','24.68','286.72','17.6', '2.73','58', '3.00','BOND','UR','RR'],
    ['Yemen','Sanaa','29000000','179.1','0','104.05','0', '27.00','63', '0.80','BOND','UR','RR'],
    ['Zambia','Lusaka','17000000','142.33','0','125.02','0', '32.50','59', '15.70','BOND','UR','RR'],
    ['Zimbabwe','Harare','16000000','301.92','0','230.91','0', '35.00','53', '761.00','BOND','UR','RR']
  ]


// Country Name, Capital City, Population, Urban Rent, Urban PE, Rural Rent, Rural PE, Interest Rate, Debt GDP, Inflation Rate

  function apiCountryCall(currentCountry) {
    const country = new Country({
      countryName: currentCountry[0],
      capitalCity: currentCountry[1],
      population: currentCountry[2],
      urbanRent: currentCountry[3],
      urbanPE: currentCountry[4],
      ruralRent: currentCountry[5],
      ruralPE: currentCountry[6],
      interestRate: currentCountry[7],
      debtGDP: currentCountry[8],
      inflation: currentCountry[9]
    });

    Country.count({countryName: currentCountry[0]}, function (err, count) {
      if (count > 0){
        Country.findOneAndUpdate(
          {countryName: currentCountry[0]},
          {$set:{
            countryName: country['countryName'],
            capitalCity: country['capitalCity'],
            population: country['population'],
            urbanRent: country['urbanRent'],
            urbanPE: country['urbanPE'],
            ruralRent: country['ruralRent'],
            ruralPE: country['ruralPE'],
            interestRate: country['interestRate'],
            debtGDP: country['debtGDP'],
            inflation: country['inflation']}},
          function (error, success) {
            if(error) {
              console.log(error);
            } else {
              console.log(currentCountry[0]);
            }
          }
        );
      } else {
        country.save();
      }
    })
  }


  const interval = 1000;

  module.exports = {
    getCountries: function () {
      for (let i = 0; i <= country.length - 1; i++) {
        setTimeout(function (i) {apiCountryCall(country[i])}, interval * i, i);
      }
    }
  };
